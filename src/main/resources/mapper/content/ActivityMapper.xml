<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.scenic.mapper.content.ActivityMapper">

    <!-- 结果映射 -->
    <resultMap id="ActivityResultMap" type="com.scenic.entity.content.Activity">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="title" property="title" jdbcType="VARCHAR"/>
        <result column="start_time" property="startTime" jdbcType="DATE"/>
        <result column="end_time" property="endTime" jdbcType="DATE"/>
        <result column="suitable_crowd" property="suitableCrowd" jdbcType="VARCHAR"/>
        <result column="location" property="location" jdbcType="VARCHAR"/>
        <result column="price" property="price" jdbcType="VARCHAR"/>
        <result column="team_limit" property="teamLimit" jdbcType="VARCHAR"/>
        <result column="content" property="content" jdbcType="LONGVARCHAR"/>
        <result column="content_image_ids" property="contentImageIds" jdbcType="VARCHAR" typeHandler="com.scenic.config.JsonTypeHandler"/>
        <result column="cover_image_id" property="coverImageId" jdbcType="BIGINT"/>
        <result column="status" property="status" jdbcType="TINYINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="create_by" property="createBy" jdbcType="BIGINT"/>
        <result column="update_by" property="updateBy" jdbcType="BIGINT"/>
        <result column="reservation_priority" property="reservationPriority" jdbcType="TINYINT"/>
        <result column="deleted" property="deleted" jdbcType="INTEGER"/>
    </resultMap>

    <!-- 查询字段 -->
    <sql id="Activity_Column_List">
        id, title, start_time, end_time, suitable_crowd, location, price, team_limit, content, content_image_ids, cover_image_id, status, create_time, update_time, create_by, update_by, reservation_priority, deleted
    </sql>

    <!-- 管理员查询活动列表 -->
    <select id="selectForAdmin" resultMap="ActivityResultMap">
        SELECT 
        <include refid="Activity_Column_List"/>
        FROM activity
        <where>
            (deleted IS NULL OR deleted = 0)
            <if test="title != null and title != ''">
                AND title LIKE CONCAT('%', #{title}, '%')
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
            <if test="startTime != null and startTime != ''">
                AND DATE(start_time) = DATE(#{startTime})
            </if>
            <if test="suitableCrowd != null and suitableCrowd != ''">
                AND suitable_crowd = #{suitableCrowd}
            </if>
        </where>
        ORDER BY create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 管理员查询活动总数 -->
    <select id="selectCountForAdmin" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM activity
        <where>
            (deleted IS NULL OR deleted = 0)
            <if test="title != null and title != ''">
                AND title LIKE CONCAT('%', #{title}, '%')
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
            <if test="startTime != null and startTime != ''">
                AND DATE(start_time) = DATE(#{startTime})
            </if>
            <if test="suitableCrowd != null and suitableCrowd != ''">
                AND suitable_crowd = #{suitableCrowd}
            </if>
        </where>
    </select>
</mapper>
